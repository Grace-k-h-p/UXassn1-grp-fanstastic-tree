<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Modern Dance | Schedule</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="NavnFooter.css">
  <!-- Bootstrap Icons for play button -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="schedule.css">
</head>

<body onload="initializePage()">
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color: #9cbcd3;">
      <div class="container-fluid">
        <a class="navbar-brand" href="home.html">
          <img src="logo.png" alt="Modern Dance Logo" class="logo">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav"
          aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="main-nav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0 ps-3 ps-lg-0">
            <li class="nav-item"><a class="nav-link px-3" href="home.html">Home</a></li>
            <li class="nav-item"><a class="nav-link active px-3" aria-current="page" href="schedule.html">Schedule</a>
            </li>
            <li class="nav-item"><a class="nav-link px-3" href="awards_history.html">Awards & History</a></li>
            <li class="nav-item"><a class="nav-link px-3" href="upcmg.html">Upcoming Events</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <section class="page-hero d-flex align-items-center text-center">
    <div class="overlay"></div>
    <div class="container">
      <h1 class="display-4 fw-bold text-white">Practice Schedules</h1>
      <p class="lead text-white-80">Find upcoming practice times and review past sessions.</p>
    </div>
  </section>

  <section class="py-5 bg-white">
    <div class="container">
      <!-- Tab navigation -->
      <ul class="nav nav-tabs" id="scheduleTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming"
            type="button" role="tab" aria-controls="upcoming" aria-selected="true">Upcoming Schedule</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button" role="tab"
            aria-controls="past" aria-selected="false">Past Schedule Archive</button>
        </li>
      </ul>

      <!-- Tab content -->
      <div class="tab-content" id="scheduleTabsContent">
        <!-- Upcoming Schedule Pane -->
        <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
          <div class="d-flex justify-content-end mb-3">
            <input type="text" id="upcomingSearch" class="form-control w-auto" placeholder="Search upcoming...">
          </div>
          <div class="table-responsive">
            <table class="table table-hover text-center align-middle">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Day</th>
                  <th>Time</th>
                  <th>Groups/Notes</th>
                </tr>
              </thead>
              <tbody id="upcoming-table-body">
                <!-- Rows will be inserted here by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Past Schedule Pane -->
        <div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab">
          <div class="d-flex justify-content-end mb-3">
            <input type="text" id="pastSearch" class="form-control w-auto" placeholder="Search archive..."
              onkeyup="handlePastSearch()">
          </div>
          <!-- This is the new container for the cards -->
          <div id="past-cards-container" class="row g-4">
            <!-- Cards will be inserted here by JavaScript -->
          </div>
          <nav aria-label="Past schedule pagination" class="mt-4">
            <ul class="pagination justify-content-center" id="pagination-controls">
              <!-- Pagination controls will be inserted here by JavaScript -->
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </section>

  <!-- Video Modal -->
  <div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="videoModalLabel">Practice Recording</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-0">
          <div class="ratio ratio-16x9">
            <iframe id="video-iframe" src="" title="YouTube video player" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
          <h5>About Modern Dance</h5>
          <p class="text-muted small">No judgments, just vibe. We're a passionate and welcoming dance group that
            performs, trains and has fun together.</p>
        </div>

        <div class="col-lg-2 col-md-3 col-6 mb-4 mb-lg-0">
          <h5>Quick Links</h5>
          <ul class="list-unstyled mb-0">
            <li><a href="home.html">Home</a></li>
            <li><a href="schedule.html">Schedule</a></li>
            <li><a href="awards_history.html">Awards</a></li>
            <li><a href="Sign_up_page.html">Sign Up</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-3 col-6 mb-4 mb-lg-0">
          <h5>Connect</h5>
          <ul class="list-unstyled mb-0">
            <li><a href="contactUs_page.html">Contact Us</a></li>
            <li><a href="#">Instagram</a></li>
            <li><a href="#">Facebook</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-12 text-md-start">
          <h5>Contact</h5>
          <p class="text-muted small mb-0">Email: <a href="mailto:moderndancenyp@gmail.com">moderndancenyp@gmail.com</a>
          </p>
        </div>
      </div>
      <hr>
      <div class="row align-items-center">
        <div class="col-md-8 col-sm-6 col-12">
          <p class="copyright-text text-muted small mb-0">&copy; 2025 Modern Dance CCA. All Rights Reserved.</p>
        </div>
        <div class="col-md-4 col-sm-6 col-12">
          <ul class="list-inline text-sm-end text-center mb-0">
            <li class="list-inline-item"><a href="#" class="text-muted small">Privacy Policy</a></li>
            <li class="list-inline-item"><a href="#" class="text-muted small">Terms of Use</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // --- DATA ---
    // This is where we store the schedule information.
    let upcomingSchedules = []; // Will be populated by fetching from a JSON file.
    let pastSchedules = []; // Will be populated by fetching from a JSON file.

    // --- DOM ELEMENTS ---
    // We get references to the parts of the page we want to interact with.
    const upcomingTableBody = document.getElementById('upcoming-table-body');
    const pastCardsContainer = document.getElementById('past-cards-container');
    const upcomingSearchInput = document.getElementById('upcomingSearch');
    const pastSearchInput = document.getElementById('pastSearch');
    const paginationControls = document.getElementById('pagination-controls');
    const videoModal = new bootstrap.Modal(document.getElementById('videoModal'));
    const videoIframe = document.getElementById('video-iframe');

    // --- PAGINATION STATE ---
    let currentPage = 1;
    const rowsPerPage = 6; // Better for a card grid layout (2x3 or 3x2)

    // --- FUNCTIONS ---

    /**
     * Renders the rows for the "Upcoming Schedule" table.
     * @param {Array} schedules - The array of schedule data to display.
     */
    function renderUpcomingTable(schedules) {
      upcomingTableBody.innerHTML = ''; // Clear existing rows
      if (schedules.length === 0) {
        upcomingTableBody.innerHTML = '<tr><td colspan="4" class="text-muted">No upcoming schedules found.</td></tr>';
        return;
      }
      schedules.forEach(item => {
        const row = `<tr>
          <td>${item.date}</td>
          <td>${item.day}</td>
          <td>${item.time}</td>
          <td>${item.notes}</td>
        </tr>`;
        upcomingTableBody.innerHTML += row;
      });
    }

    /**
     * Renders the "Past Schedule" items as cards with video previews.
     * @param {Array} schedules - The array of schedule data to display.
     * @param {number} page - The current page number.
     */
    function renderPastCards(schedules, page) {
      pastCardsContainer.innerHTML = ''; // Clear existing cards

      const startIndex = (page - 1) * rowsPerPage;
      const endIndex = startIndex + rowsPerPage;
      const paginatedItems = schedules.slice(startIndex, endIndex);

      if (paginatedItems.length === 0) {
        pastCardsContainer.innerHTML = '<div class="col-12"><p class="text-center text-muted">No past schedules found.</p></div>';
        return;
      }

      paginatedItems.forEach(item => {
        let cardHTML = '';
        const videoId = getYouTubeVideoId(item.videoUrl);

        if (videoId) {
          const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
          cardHTML = `
            <div class="col-md-6 col-lg-4">
              <div class="card video-card h-100" onclick="openVideoModal('${item.videoUrl}')">
                <div class="ratio ratio-16x9 bg-dark rounded-top">
                  <img src="${thumbnailUrl}" class="img-fluid" alt="Practice video thumbnail for ${item.date}" style="object-fit: cover;">
                  <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center play-icon-overlay">
                    <i class="bi bi-play-circle-fill text-white" style="font-size: 3rem; text-shadow: 0 0 10px rgba(0,0,0,0.7);"></i>
                  </div>
                </div>
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">${item.date}</h5>
                  <p class="card-text text-muted mb-0">${item.day} - ${item.time}</p>
                </div>
              </div>
            </div>
          `;
        } else {
          cardHTML = `
            <div class="col-md-6 col-lg-4">
              <div class="card h-100">
                <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                  <h5 class="card-title">${item.date}</h5>
                  <p class="card-text">${item.day} - ${item.time}</p>
                  <span class="badge bg-secondary mt-2">No Video Available</span>
                </div>
              </div>
            </div>
          `;
        }
        pastCardsContainer.innerHTML += cardHTML;
      });
    }

    /**
     * Sets up simple Previous/Next pagination controls, which is easier for beginners.
     * @param {Array} schedules - The full array of schedule data.
     */
    function setupPagination(schedules) {
      paginationControls.innerHTML = ''; // Clear old controls
      const pageCount = Math.ceil(schedules.length / rowsPerPage);

      if (pageCount <= 1) {
        return; // No need for pagination if there's only one page or less.
      }

      // Determine if the Previous and Next buttons should be disabled
      const prevDisabledClass = currentPage === 1 ? 'disabled' : '';
      const nextDisabledClass = currentPage === pageCount ? 'disabled' : '';

      // Create the HTML for the simplified pagination controls
      const paginationHTML = `
        <li class="page-item ${prevDisabledClass}">
          <a class="page-link" href="#" onclick="event.preventDefault(); changePage(${currentPage - 1})">Previous</a>
        </li>
        <li class="page-item disabled"><span class="page-link">Page ${currentPage} of ${pageCount}</span></li>
        <li class="page-item ${nextDisabledClass}">
          <a class="page-link" href="#" onclick="event.preventDefault(); changePage(${currentPage + 1})">Next</a>
        </li>
      `;

      paginationControls.innerHTML = paginationHTML;
    }

    /**
     * Handles changing the page for the past schedules table.
     * @param {number} page - The page number to navigate to.
     */
    function changePage(page) {
      const filteredSchedules = getFilteredPastSchedules();
      const pageCount = Math.ceil(filteredSchedules.length / rowsPerPage);
      if (page < 1 || page > pageCount) return; // Prevent going to invalid pages

      currentPage = page;
      renderPastCards(filteredSchedules, currentPage);
      setupPagination(filteredSchedules);
    }

    /**
     * Extracts the YouTube video ID from various URL formats.
     * @param {string} url - The YouTube URL.
     * @returns {string|null} The video ID or null if not found.
     */
    function getYouTubeVideoId(url) {
      if (!url) return null;
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : null;
    }

    /**
     * Opens the Bootstrap modal and sets the video source.
     * @param {string} url - The URL of the YouTube video to embed.
     */
    function openVideoModal(url) {
      videoIframe.src = url;
      videoModal.show();
    }

    /**
     * Helper function to get the currently filtered past schedules.
     */
    function getFilteredPastSchedules() {
      const searchTerm = pastSearchInput.value.toLowerCase();
      return pastSchedules.filter(item =>
        Object.values(item).some(val =>
          String(val).toLowerCase().includes(searchTerm)
        )
      );
    }

    /**
     * Helper function to get the currently filtered upcoming schedules.
     */
    function getFilteredUpcomingSchedules() {
      const searchTerm = upcomingSearchInput.value.toLowerCase();
      return upcomingSchedules.filter(item =>
        Object.values(item).some(val =>
          String(val).toLowerCase().includes(searchTerm)
        )
      );
    }

    /**
     * Handles filtering and re-rendering the upcoming schedules table based on search input.
     */
    function handleUpcomingSearch() {
      const filteredSchedules = getFilteredUpcomingSchedules();
      renderUpcomingTable(filteredSchedules);
    }

    /**
     * Handles filtering and re-rendering the past schedules table based on search input.
     */
    function handlePastSearch() {
      currentPage = 1; // Reset to first page on new search
      const filteredSchedules = getFilteredPastSchedules();
      renderPastCards(filteredSchedules, currentPage);
      setupPagination(filteredSchedules);
    }

    /**
     * Initializes the page by fetching remote data and rendering the initial view.
     */
    async function initializePage() {
      // URLs for the data.
      const upcomingUrl = 'https://gist.githubusercontent.com/angelynnmr/f0a1c21268f333f3ec2dd3e1bb833823/raw/d4e55b12d0a43b41bf6372d52174e9aa24bfc9e2/upcomingSchedule.json';
      const pastUrl = 'https://gist.githubusercontent.com/angelynnmr/f0a1c21268f333f3ec2dd3e1bb833823/raw/4fc55a340a7f154e65f3d6ece285503ae057fcb0/pastSchedule.json';

      // Fetch both data sources in parallel for better performance.
      const [upcomingResult, pastResult] = await Promise.all([
        fetch(upcomingUrl).then(res => {
          if (!res.ok) throw new Error(`Upcoming fetch failed: ${res.status}`);
          return res.json();
        }).catch(e => ({ error: e })),
        fetch(pastUrl).then(res => {
          if (!res.ok) throw new Error(`Past fetch failed: ${res.status}`);
          return res.json();
        }).catch(e => ({ error: e }))
      ]);

      // Process upcoming schedules
      if (upcomingResult.error) {
        console.error("Could not fetch upcoming schedules:", upcomingResult.error);
        upcomingTableBody.innerHTML = '<tr><td colspan="4" class="text-danger text-center">Could not load upcoming schedule. Please try again later.</td></tr>';
      } else {
        upcomingSchedules = upcomingResult;
      }

      // Process past schedules
      if (pastResult.error) {
        console.error("Could not fetch past schedules:", pastResult.error);
        pastCardsContainer.innerHTML = '<div class="col-12"><p class="text-center text-danger">Could not load past schedule archive. Please try again later.</p></div>';
      } else {
        pastSchedules = pastResult;
      }

      // Render the page content with the (potentially empty) data.
      renderUpcomingTable(upcomingSchedules);
      const initialPastSchedules = getFilteredPastSchedules();
      renderPastCards(initialPastSchedules, currentPage);
      setupPagination(initialPastSchedules);
    }

    // --- EVENT LISTENERS ---


    document.getElementById('videoModal').addEventListener('hidden.bs.modal', () => {
      videoIframe.src = '';
    });
    // Make functions available globally so inline onclick attributes can find them
    window.openVideoModal = openVideoModal;
    window.changePage = changePage;
  </script>
</body>

</html>